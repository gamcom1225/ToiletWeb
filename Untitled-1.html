<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì™•í¬TT - Toilet Talk</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans KR', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            max-width: 414px;
            margin: 0 auto;
            height: 100vh;
            position: relative;
        }

        .container {
            background-color: white;
            height: 100%;
            position: relative;
            overflow-y: auto;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        header {
            background-color: #4361ee;
            color: white;
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title {
            font-size: 20px;
            font-weight: bold;
        }

        /* íƒ­ ë©”ë‰´ */
        .tabs {
            display: flex;
            background-color: #fff;
            border-bottom: 1px solid #ddd;
            position: sticky;
            top: 51px;
            z-index: 99;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            border-bottom: 3px solid #4361ee;
            color: #4361ee;
            font-weight: bold;
        }

        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */
        .content {
            padding: 15px;
        }

        /* ì§€ë„ ë·° */
        .map-view {
            height: calc(100vh - 180px);
            background-color: #eef2ff;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .map-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .toilet-marker {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .toilet-marker.clean {
            background-color: #4ade80;
        }

        .toilet-marker.normal {
            background-color: #facc15;
        }

        .toilet-marker.dirty {
            background-color: #f87171;
        }

        /* ëª©ë¡ ë·° */
        .list-view {
            display: none;
            height: calc(100vh - 180px);
            overflow-y: auto;
        }

        .toilet-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .toilet-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .status-label {
            color: #666;
        }

        .status-value {
            font-weight: 500;
        }

        .status-value.good {
            color: #4ade80;
        }

        .status-value.normal {
            color: #facc15;
        }

        .status-value.bad {
            color: #f87171;
        }

        .timestamp {
            font-size: 12px;
            color: #999;
            text-align: right;
            margin-top: 5px;
        }

        /* í•˜ë‹¨ FAB */
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: #4361ee;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.3s;
            z-index: 100;
            cursor: pointer;
        }

        .fab:active {
            transform: scale(0.95);
        }

        .fab-icon {
            color: white;
            font-size: 24px;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 15px;
            width: 90%;
            max-width: 370px;
            padding: 20px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        .status-section {
            margin-bottom: 20px;
        }

        .status-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-options {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
        }

        .status-option {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .status-option.selected {
            border-color: #4361ee;
            background-color: #eef2ff;
            color: #4361ee;
            font-weight: bold;
        }

        .submit-btn {
            background-color: #4361ee;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px;
            width: 100%;
            font-weight: bold;
            margin-top: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:active {
            transform: scale(0.98);
            background-color: #3a56d4;
        }

        /* í™”ì¥ì‹¤ ìƒì„¸ ëª¨ë‹¬ */
        .detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .detail-title {
            font-size: 18px;
            font-weight: bold;
        }

        .history-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .history-title {
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 5px;
        }

        .report-btn {
            background-color: #4361ee;
            color: white;
            border: none;
            border-radius:.10px;
            padding: 12px;
            width: 100%;
            font-weight: bold;
            margin-top: 15px;
            cursor: pointer;
        }

        /* í•˜ë‹¨ íƒ­ë°” */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 414px;
            background-color: white;
            display: flex;
            border-top: 1px solid #eee;
            padding: 10px 0;
            z-index: 50;
        }

        .bottom-tab {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #777;
            cursor: pointer;
        }

        .bottom-tab.active {
            color: #4361ee;
            font-weight: bold;
        }

        .tab-icon {
            font-size: 18px;
            margin-bottom: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-title">ì™•í¬TT - Toilet Talk</div>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('map')">ì§€ë„ ë³´ê¸°</div>
            <div class="tab" onclick="switchTab('list')">ëª©ë¡ ë³´ê¸°</div>
        </div>

        <div class="content">
            <!-- ì§€ë„ ë·° -->
            <div class="map-view" id="mapView">
                <div class="map-container">
                    <!-- í™”ì¥ì‹¤ ë§ˆì»¤ë“¤ -->
                    <div class="toilet-marker clean" style="top: 25%; left: 30%;" onclick="openDetailModal('ê¸‰ì‹ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤1')">ê¸‰1</div>
                    <div class="toilet-marker normal" style="top: 25%; left: 70%;" onclick="openDetailModal('ê¸‰ì‹ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤2')">ê¸‰2</div>
                    <div class="toilet-marker dirty" style="top: 50%; left: 30%;" onclick="openDetailModal('1í•™ë…„ì¸µ ë‚¨ìí™”ì¥ì‹¤')">1ë‚¨</div>
                    <div class="toilet-marker normal" style="top: 50%; left: 70%;" onclick="openDetailModal('ë³´ê±´ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤')">0</div>
                    <div class="toilet-marker clean" style="top: 75%; left: 30%;" onclick="openDetailModal('ììŠµì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤1')">ìë‚¨1</div>
                    <div class="toilet-marker clean" style="top: 75%; left: 70%;" onclick="openDetailModal('ììŠµì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤2')">ìë‚¨2</div>
                </div>
            </div>

            <!-- ëª©ë¡ ë·° -->
            <div class="list-view" id="listView">
                <!-- í™”ì¥ì‹¤ ì¹´ë“œë“¤ -->
                <div class="toilet-card" onclick="openDetailModal('ê¸‰ì‹ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤1')">
                    <div class="toilet-name">ê¸‰ì‹ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤1</div>
                    <div class="status-row">
                        <span class="status-label">ì²­ê²°</span>
                        <span class="status-value good">ê¹¨ë—í•¨</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">í˜¼ì¡ë„</span>
                        <span class="status-value good">í•œì‚°</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">ë¹„í’ˆ ìƒíƒœ</span>
                        <span class="status-value good">ì¶©ë¶„</span>
                    </div>
                    <div class="timestamp">5ë¶„ ì „ ì—…ë°ì´íŠ¸</div>
                </div>

                <div class="toilet-card" onclick="openDetailModal('ê¸‰ì‹ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤2')">
                    <div class="toilet-name">ê¸‰ì‹ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤2</div>
                    <div class="status-row">
                        <span class="status-label">ì²­ê²°</span>
                        <span class="status-value normal">ë³´í†µ</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">í˜¼ì¡ë„</span>
                        <span class="status-value normal">ë³´í†µ</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">ë¹„í’ˆ ìƒíƒœ</span>
                        <span class="status-value normal">ë³´í†µ</span>
                    </div>
                    <div class="timestamp">10ë¶„ ì „ ì—…ë°ì´íŠ¸</div>
                </div>

                <div class="toilet-card" onclick="openDetailModal('1í•™ë…„ì¸µ ë‚¨ìí™”ì¥ì‹¤')">
                    <div class="toilet-name">1í•™ë…„ì¸µ ë‚¨ìí™”ì¥ì‹¤</div>
                    <div class="status-row">
                        <span class="status-label">ì²­ê²°</span>
                        <span class="status-value bad">ë”ëŸ¬ì›€</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">í˜¼ì¡ë„</span>
                        <span class="status-value bad">í˜¼ì¡</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">ë¹„í’ˆ ìƒíƒœ</span>
                        <span class="status-value bad">ì—†ìŒ</span>
                    </div>
                    <div class="timestamp">3ë¶„ ì „ ì—…ë°ì´íŠ¸</div>
                </div>

                <div class="toilet-card" onclick="openDetailModal('ë³´ê±´ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤')">
                    <div class="toilet-name">ë³´ê±´ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤</div>
                    <div class="status-row">
                        <span class="status-label">ì²­ê²°</span>
                        <span class="status-value normal">ë³´í†µ</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">í˜¼ì¡ë„</span>
                        <span class="status-value normal">ë³´í†µ</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">ë¹„í’ˆ ìƒíƒœ</span>
                        <span class="status-value good">ì¶©ë¶„</span>
                    </div>
                    <div class="timestamp">15ë¶„ ì „ ì—…ë°ì´íŠ¸</div>
                </div>

                <div class="toilet-card" onclick="openDetailModal('ììŠµì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤1')">
                    <div class="toilet-name">ììŠµì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤1</div>
                    <div class="status-row">
                        <span class="status-label">ì²­ê²°</span>
                        <span class="status-value good">ê¹¨ë—í•¨</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">í˜¼ì¡ë„</span>
                        <span class="status-value good">í•œì‚°</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">ë¹„í’ˆ ìƒíƒœ</span>
                        <span class="status-value good">ì¶©ë¶„</span>
                    </div>
                    <div class="timestamp">7ë¶„ ì „ ì—…ë°ì´íŠ¸</div>
                </div>

                <div class="toilet-card" onclick="openDetailModal('ììŠµì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤2')">
                    <div class="toilet-name">ììŠµì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤2</div>
                    <div class="status-row">
                        <span class="status-label">ì²­ê²°</span>
                        <span class="status-value good">ê¹¨ë—í•¨</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">í˜¼ì¡ë„</span>
                        <span class="status-value normal">ë³´í†µ</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">ë¹„í’ˆ ìƒíƒœ</span>
                        <span class="status-value good">ì¶©ë¶„</span>
                    </div>
                    <div class="timestamp">12ë¶„ ì „ ì—…ë°ì´íŠ¸</div>
                </div>
            </div>
        </div>

        <!-- FAB ë²„íŠ¼ -->
        <div class="fab" onclick="openReportModal()">
            <div class="fab-icon">+</div>
        </div>

        <!-- í•˜ë‹¨ íƒ­ë°” -->
        <div class="bottom-bar">
            <div class="bottom-tab active" onclick="switchTab('map')">
                <div class="tab-icon">ğŸ—ºï¸</div>
                <div>ì§€ë„</div>
            </div>
            <div class="bottom-tab" onclick="switchTab('list')">
                <div class="tab-icon">ğŸ“‹</div>
                <div>ëª©ë¡</div>
            </div>
            <div class="bottom-tab" onclick="openHistoryModal()">
                <div class="tab-icon">ğŸ“Š</div>
                <div>í†µê³„</div>
            </div>
            <div class="bottom-tab" onclick="openSettingsModal()">
                <div class="tab-icon">âš™ï¸</div>
                <div>ì„¤ì •</div>
            </div>
        </div>
    </div>

    <!-- ìƒíƒœ ë“±ë¡ ëª¨ë‹¬ -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">í™”ì¥ì‹¤ ìƒíƒœ ë“±ë¡</div>
                <button class="close-btn" onclick="closeModal('reportModal')">&times;</button>
            </div>
            
            <div class="status-section">
                <div class="status-title">í™”ì¥ì‹¤ ì„ íƒ</div>
                <select id="toiletSelect" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="ê¸‰ì‹ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤1">ê¸‰ì‹ì‹¤ ë‚¨ìí™”ì¥ì‹¤1</option>
                    <option value="ê¸‰ì‹ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤2">ê¸‰ì‹ì‹¤ ë‚¨ìí™”ì¥ì‹¤2</option>
                    <option value="1í•™ë…„ì¸µ ë‚¨ìí™”ì¥ì‹¤">1í•™ë…„ì¸µ ë‚¨ìí™”ì¥ì‹¤1</option>
                    <option value="ë³´ê±´ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤">1í•™ë…„ì¸µ ë‚¨ìí™”ì¥ì‹¤2</option>
                    <option value="ììŠµì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤1">ììŠµì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤1</option>
                    <option value="ììŠµì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤2">ììŠµì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤2</option>
                </select>
            </div>
            
            <div class="status-section">
                <div class="status-title">ì²­ê²° ìƒíƒœ</div>
                <div class="status-options">
                    <div class="status-option" data-value="clean" onclick="selectOption(this, 'cleanliness')">ê¹¨ë—í•¨</div>
                    <div class="status-option" data-value="normal" onclick="selectOption(this, 'cleanliness')">ë³´í†µ</div>
                    <div class="status-option" data-value="dirty" onclick="selectOption(this, 'cleanliness')">ë”ëŸ¬ì›€</div>
                </div>
            </div>
            
            <div class="status-section">
                <div class="status-title">í˜¼ì¡ë„</div>
                <div class="status-options">
                    <div class="status-option" data-value="low" onclick="selectOption(this, 'crowdedness')">í•œì‚°</div>
                    <div class="status-option" data-value="medium" onclick="selectOption(this, 'crowdedness')">ë³´í†µ</div>
                    <div class="status-option" data-value="high" onclick="selectOption(this, 'crowdedness')">í˜¼ì¡</div>
                </div>
            </div>
            
            <div class="status-section">
                <div class="status-title">ë¹„í’ˆ ìƒíƒœ</div>
                <div class="status-options">
                    <div class="status-option" data-value="full" onclick="selectOption(this, 'supplies')">ì¶©ë¶„</div>
                    <div class="status-option" data-value="medium" onclick="selectOption(this, 'supplies')">ë¶€ì¡±</div>
                    <div class="status-option" data-value="empty" onclick="selectOption(this, 'supplies')">ì—†ìŒ</div>
                </div>
            </div>
            
            <button class="submit-btn" onclick="submitReport()">ë“±ë¡í•˜ê¸°</button>
        </div>
    </div>

    <!-- í™”ì¥ì‹¤ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="detail-modal" id="detailModal">
        <div class="modal-content">
            <div class="detail-header">
                <div class="detail-title" id="detailTitle">í™”ì¥ì‹¤ ìƒì„¸ ì •ë³´</div>
                <button class="close-btn" onclick="closeModal('detailModal')">&times;</button>
            </div>
            
            <div class="status-row">
                <span class="status-label">ì²­ê²°</span>
                <span class="status-value good" id="detailCleanliness">ê¹¨ë—í•¨</span>
            </div>
            <div class="status-row">
                <span class="status-label">í˜¼ì¡ë„</span>
                <span class="status-value good" id="detailCrowdedness">í•œì‚°</span>
            </div>
            <div class="status-row">
                <span class="status-label">ë¹„í’ˆ ìƒíƒœ</span>
                <span class="status-value good" id="detailSupplies">ì¶©ë¶„</span>
            </div>
            <div class="timestamp" id="detailTimestamp">5ë¶„ ì „ ì—…ë°ì´íŠ¸</div>
            
            <div class="history-title">ìµœê·¼ ê¸°ë¡ (10ê°œ)</div>
            <div id="historyList">
                <div class="history-item">
                    <div class="status-row">
                        <span class="status-label">ìƒíƒœ</span>
                        <span class="status-value good">ê¹¨ë—í•¨ / í•œì‚° / ì¶©ë¶„</span>
                    </div>
                    <div class="timestamp">2025.04.05 13:45 ì—…ë°ì´íŠ¸</div>
                </div>
                <div class="history-item">
                    <div class="status-row">
                        <span class="status-label">ìƒíƒœ</span>
                        <span class="status-value normal">ë³´í†µ / ë³´í†µ / ì¶©ë¶„</span>
                    </div>
                    <div class="timestamp">2025.04.05 12:30 ì—…ë°ì´íŠ¸</div>
                </div>
                <div class="history-item">
                    <div class="status-row">
                        <span class="status-label">ìƒíƒœ</span>
                        <span class="status-value normal">ë³´í†µ / í•œì‚° / ë¶€ì¡±</span>
                    </div>
                    <div class="timestamp">2025.04.05 11:15 ì—…ë°ì´íŠ¸</div>
                </div>
            </div>
            
            <button class="report-btn" onclick="reportFromDetail()">ìƒíƒœ ë“±ë¡í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // Firebase ì„¤ì •
        // ì£¼ì˜: ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì´ API í‚¤ë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤
        const firebaseConfig = {
            apiKey: "AIzaSyCJ05SBHSwPm5A7HBVjDqnYENxJ2Zq1Nu0", // ì‹¤ì œ Firebase ì½˜ì†”ì—ì„œ ë°œê¸‰ë°›ì€ í‚¤ë¡œ ë³€ê²½í•˜ì„¸ìš”
            authDomain: "toiletwep.firebaseapp.com", // ë³€ê²½ í•„ìš”
            databaseURL: "https://toiletwep-default-rtdb.firebaseio.com/", // ë³€ê²½ í•„ìš”
            projectId: "toiletwep", // ë³€ê²½ í•„ìš”
            storageBucket: "toiletwep.firebasestorage.app", // ë³€ê²½ í•„ìš”
            messagingSenderId: "394177013851", // ë³€ê²½ í•„ìš”
            appId: "1:394177013851:web:97b8cf3a1c7946a480377e" // ë³€ê²½ í•„ìš”
        };
        // ì„ íƒëœ ìƒíƒœ ì •ë³´ ì €ì¥ìš© ê°ì²´
        let selectedStatus = {
            cleanliness: null,
            crowdedness: null,
            supplies: null
        };

        // ì˜µì…˜ ì„ íƒ í•¨ìˆ˜
        function selectOption(element, category) {
            // ê°™ì€ ì¹´í…Œê³ ë¦¬ì˜ ëª¨ë“  ì˜µì…˜ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
            const options = element.parentElement.querySelectorAll('.status-option');
            options.forEach(option => option.classList.remove('selected'));
    
            // ì„ íƒí•œ ì˜µì…˜ì— selected í´ë˜ìŠ¤ ì¶”ê°€
            element.classList.add('selected');
    
            // ì„ íƒëœ ê°’ ì €ì¥
            selectedStatus[category] = element.getAttribute('data-value');
        }

        // ìƒíƒœ ì œì¶œ í•¨ìˆ˜
        function submitReport() {
            // ì„ íƒëœ í™”ì¥ì‹¤
            const toiletSelect = document.getElementById('toiletSelect');
            const toiletName = toiletSelect.value;
    
            // í•„ìˆ˜ ê°’ í™•ì¸
            if (!selectedStatus.cleanliness || !selectedStatus.crowdedness || !selectedStatus.supplies) {
                alert('ëª¨ë“  ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
    
            // í˜„ì¬ ì‹œê°„
            const now = new Date();
            const timestamp = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')} ì—…ë°ì´íŠ¸`;
    
            // ì €ì¥í•  ë°ì´í„°
            const data = {
                toiletName: toiletName,
                cleanliness: selectedStatus.cleanliness,
                crowdedness: selectedStatus.crowdedness, 
                supplies: selectedStatus.supplies,
                timestamp: timestamp,
                createdAt: Date.now()
            };
    
            // Firebaseì— ì €ì¥
            const success = saveToFirebase(data);
    
            if (success) {
                alert('í™”ì¥ì‹¤ ìƒíƒœê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeModal('reportModal');
        
                // ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
                selectedStatus = {
                    cleanliness: null,
                    crowdedness: null,
                    supplies: null
                };
        
                // ì„ íƒ UI ì´ˆê¸°í™”
                document.querySelectorAll('.status-option').forEach(option => {
                    option.classList.remove('selected');
                });
        
                // í™”ë©´ ì—…ë°ì´íŠ¸
                updateAllToilets();
            }
        }

        // ê¸€ë¡œë²Œ ë³€ìˆ˜
        let selectedToilet = null;

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchTab(tabName) {
            const mapView = document.getElementById('mapView');
            const listView = document.getElementById('listView');
            const mapTab = document.querySelector('.tab:nth-child(1)');
            const listTab = document.querySelector('.tab:nth-child(2)');
            const mapBottomTab = document.querySelector('.bottom-tab:nth-child(1)');
            const listBottomTab = document.querySelector('.bottom-tab:nth-child(2)');
    
            if (tabName === 'map') {
                mapView.style.display = 'block';
                listView.style.display = 'none';
                mapTab.classList.add('active');
                listTab.classList.remove('active');
                mapBottomTab.classList.add('active');
                listBottomTab.classList.remove('active');
            } else {
                mapView.style.display = 'none';
                listView.style.display = 'block';
                mapTab.classList.remove('active');
                listTab.classList.add('active');
                mapBottomTab.classList.remove('active');
                listBottomTab.classList.add('active');
            }
        }

        // í™”ì¥ì‹¤ ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°
        function openDetailModal(toiletName) {
            selectedToilet = toiletName;
            document.getElementById('detailTitle').textContent = toiletName;
            document.getElementById('detailModal').style.display = 'flex';
    
            // ë°ì´í„° ë¡œë“œ
            loadToiletDetails(toiletName);
        }

        // ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°
        function openReportModal() {
            document.getElementById('reportModal').style.display = 'flex';
        }

        // ìƒì„¸ ëª¨ë‹¬ì—ì„œ ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°
        function reportFromDetail() {
            document.getElementById('detailModal').style.display = 'none';
    
            // ì„ íƒëœ í™”ì¥ì‹¤ ì„¤ì •
            const toiletSelect = document.getElementById('toiletSelect');
            for (let i = 0; i < toiletSelect.options.length; i++) {
                if (toiletSelect.options[i].value === selectedToilet) {
                    toiletSelect.selectedIndex = i;
                    break;
                }
            }
    
            openReportModal();
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ë”ë¯¸ ë°ì´í„° ì„¤ì • (Firebase ì—°ê²° ì‹¤íŒ¨ ì‹œ)
        function setDummyToiletData(toiletName) {
            // ì²­ê²°ë„, í˜¼ì¡ë„, ë¹„í’ˆ ìƒíƒœ ê¸°ë³¸ê°’
            document.getElementById('detailTitle').textContent = toiletName;
            document.getElementById('detailCleanliness').textContent = 'ì •ë³´ ì—†ìŒ';
            document.getElementById('detailCrowdedness').textContent = 'ì •ë³´ ì—†ìŒ';
            document.getElementById('detailSupplies').textContent = 'ì •ë³´ ì—†ìŒ';
            document.getElementById('detailTimestamp').textContent = 'ì •ë³´ ì—†ìŒ';
    
            // í´ë˜ìŠ¤ ì´ˆê¸°í™”
            document.getElementById('detailCleanliness').className = 'status-value normal';
            document.getElementById('detailCrowdedness').className = 'status-value normal';
            document.getElementById('detailSupplies').className = 'status-value normal';
    
            // íˆìŠ¤í† ë¦¬ ë¹„ìš°ê¸°
            document.getElementById('historyList').innerHTML = '<div class="history-item">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }

        // ê°’ì— ë”°ë¥¸ í´ë˜ìŠ¤ ê°€ì ¸ì˜¤ê¸°
        function getValueClass(value) {
            if (value === 'ê¹¨ë—í•¨' || value === 'í•œì‚°' || value === 'ì¶©ë¶„') {
                return 'good';
            } else if (value === 'ë”ëŸ¬ì›€' || value === 'í˜¼ì¡' || value === 'ì—†ìŒ') {
                return 'bad';
            } else {
                return 'normal';
            }
        }

        // ìƒíƒœ í´ë˜ìŠ¤ ì„¤ì •
        function setStatusClass(elementId, value) {
            const element = document.getElementById(elementId);
            element.className = 'status-value ' + getValueClass(value);
        }

        // ì „ì²´ ìƒíƒœ í´ë˜ìŠ¤ ê°€ì ¸ì˜¤ê¸°
        function getStatusClass(cleanliness, crowdedness, supplies) {
            // ì²­ê²°ë„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìƒíƒœ í´ë˜ìŠ¤ ê²°ì •
            if (cleanliness === 'clean') {
                return 'good';
            } else if (cleanliness === 'dirty') {
                return 'bad';
            } else {
                return 'normal';
            }
        }

        // ë¯¸êµ¬í˜„ ëª¨ë‹¬ (í†µê³„, ì„¤ì •)
        function openHistoryModal() {
            alert('í†µê³„ ê¸°ëŠ¥ì€ ì•„ì§ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
        }

        function openSettingsModal() {
            alert('ì„¤ì • ê¸°ëŠ¥ì€ ì•„ì§ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
        }

        // Firebase ì´ˆê¸°í™” (ê¸°ì¡´ ì´ˆê¸°í™” í•¨ìˆ˜ ëŒ€ì²´)
        function initFirebase() {
            try {
                // Firebaseê°€ ì´ë¯¸ ì´ˆê¸°í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                return firebase.database();
            } catch (error) {
                console.error("Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:", error);
                alert("ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                return null;
            }
        }

        // Firebaseì— ë°ì´í„° ì €ì¥ í•¨ìˆ˜ ê°œì„ 
        function saveToFirebase(data) {
            const database = initFirebase();
            if (!database) return false;
    
            try {
                // 1. toiletReports ì»¬ë ‰ì…˜ì— ìƒˆ ë¦¬í¬íŠ¸ ì¶”ê°€ (íƒ€ì„ìŠ¤íƒ¬í”„ í‚¤ë¡œ ì •ë ¬ ê°€ëŠ¥í•˜ê²Œ)
                const reportsRef = database.ref('toiletReports');
                const newReportRef = reportsRef.push();
                newReportRef.set({
                    ...data,
                    reportId: newReportRef.key // ì°¸ì¡°ìš© ID ì¶”ê°€
                });
        
                // 2. íŠ¹ì • í™”ì¥ì‹¤ë³„ ë¦¬í¬íŠ¸ ê¸°ë¡ (íˆìŠ¤í† ë¦¬ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´)
                const toiletHistoryRef = database.ref(`toiletHistory/${data.toiletName.replace(/\s/g, '_')}`);
                toiletHistoryRef.push(data);
        
                // 3. í•´ë‹¹ í™”ì¥ì‹¤ì˜ ìµœì‹  ìƒíƒœ ì—…ë°ì´íŠ¸
                const latestRef = database.ref(`latestStatus/${data.toiletName.replace(/\s/g, '_')}`);
                latestRef.set(data);
        
                return true;
            } catch (error) {
                console.error("ë°ì´í„° ì €ì¥ ì˜¤ë¥˜:", error);
                alert("ìƒíƒœ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                return false;
            }
        }

        // í™”ì¥ì‹¤ ìµœì‹  ìƒíƒœ ë¡œë“œ (íŠ¹ì • í™”ì¥ì‹¤)
        function loadToiletDetails(toiletName) {
            const database = initFirebase();
            if (!database) {
                // Firebase ì—°ê²° ì‹¤íŒ¨ ì‹œ ë”ë¯¸ ë°ì´í„° ëŒ€ì²´
                setDummyToiletData(toiletName);
                return;
            }
    
            const latestRef = database.ref(`latestStatus/${toiletName.replace(/\s/g, '_')}`);
            latestRef.once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
            
                    if (data) {
                        // Firebase ë°ì´í„°ë¡œ UI ì—…ë°ì´íŠ¸
                        updateToiletDetailUI(data);
                
                        // íˆìŠ¤í† ë¦¬ ë¡œë“œ
                        loadToiletHistory(toiletName);
                    } else {
                        // ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ë”ë¯¸ ë°ì´í„°
                        setDummyToiletData(toiletName);
                    }
                })
                .catch((error) => {
                    console.error("ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", error);
                    setDummyToiletData(toiletName);
                });
        }

        // í™”ì¥ì‹¤ íˆìŠ¤í† ë¦¬ ë¡œë“œ
        function loadToiletHistory(toiletName) {
            const database = initFirebase();
            if (!database) return;
    
            const historyRef = database.ref(`toiletHistory/${toiletName.replace(/\s/g, '_')}`);
            // ìµœê·¼ 10ê°œ ê¸°ë¡ë§Œ ê°€ì ¸ì˜¤ê¸°
            historyRef.orderByChild('createdAt').limitToLast(10).once('value')
                .then((snapshot) => {
                    const historyList = document.getElementById('historyList');
                    historyList.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
            
                    const data = snapshot.val();
            
                    if (data) {
                        // ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
                        const historyItems = Object.keys(data)
                            .map(key => ({
                                ...data[key],
                                key
                            }))
                            .sort((a, b) => b.createdAt - a.createdAt);
                
                        // íˆìŠ¤í† ë¦¬ í•­ëª© ì¶”ê°€
                        historyItems.forEach(item => {
                            addHistoryItem(historyList, item);
                        });
                    } else {
                        historyList.innerHTML = '<div class="history-item">ìµœê·¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }
                })
                .catch((error) => {
                    console.error("íˆìŠ¤í† ë¦¬ ë¡œë“œ ì˜¤ë¥˜:", error);
                    document.getElementById('historyList').innerHTML = 
                        '<div class="history-item">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                });
        }

        // íˆìŠ¤í† ë¦¬ í•­ëª© ì¶”ê°€ í•¨ìˆ˜
        function addHistoryItem(container, data) {
            // ì²­ê²°ë„, í˜¼ì¡ë„, ë¹„í’ˆ í…ìŠ¤íŠ¸ ë³€í™˜
            const cleanlinessText = getStatusText('cleanliness', data.cleanliness);
            const crowdednessText = getStatusText('crowdedness', data.crowdedness);
            const suppliesText = getStatusText('supplies', data.supplies);
    
            // ìƒíƒœ ì¢…í•©
            let statusClass = getStatusClass(data.cleanliness, data.crowdedness, data.supplies);
    
            const historyHtml = `
                <div class="history-item">
                    <div class="status-row">
                        <span class="status-label">ìƒíƒœ</span>
                        <span class="status-value ${statusClass}">${cleanlinessText} / ${crowdednessText} / ${suppliesText}</span>
                    </div>
                    <div class="timestamp">${data.timestamp}</div>
                </div>
    `       ;
    
            container.innerHTML += historyHtml;
        }

        // ìƒíƒœê°’ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
        function getStatusText(category, value) {
            if (category === 'cleanliness') {
                return value === 'clean' ? 'ê¹¨ë—í•¨' : (value === 'dirty' ? 'ë”ëŸ¬ì›€' : 'ë³´í†µ');
            } else if (category === 'crowdedness') {
                return value === 'low' ? 'í•œì‚°' : (value === 'high' ? 'í˜¼ì¡' : 'ë³´í†µ');
            } else if (category === 'supplies') {
                return value === 'full' ? 'ì¶©ë¶„' : (value === 'empty' ? 'ì—†ìŒ' : 'ë¶€ì¡±');
            }
            return 'ì •ë³´ ì—†ìŒ';
        }

        // ì „ì²´ í™”ì¥ì‹¤ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì§€ë„ ë° ëª©ë¡)
        function updateAllToilets() {
            const database = initFirebase();
            if (!database) return;
    
            const latestRef = database.ref('latestStatus');
            latestRef.once('value')
                .then((snapshot) => {
                    const data = snapshot.val() || {};
            
                    // ëª¨ë“  í™”ì¥ì‹¤ ë§ˆì»¤ ë° ì¹´ë“œ ì—…ë°ì´íŠ¸
                    for (const key in data) {
                        const toiletName = key.replace(/_/g, ' ');
                        const toiletData = data[key];
                
                        // ë§ˆì»¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                        updateToiletMarker(toiletName, toiletData.cleanliness);
                
                        // ëª©ë¡ ì¹´ë“œ ì—…ë°ì´íŠ¸
                        updateToiletCard(toiletName, toiletData);
                    }
                })
                .catch((error) => {
                    console.error("ì „ì²´ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", error);
                });
        }

        // í™”ì¥ì‹¤ ë§ˆì»¤ ì—…ë°ì´íŠ¸
        function updateToiletMarker(toiletName, cleanlinessStatus) {
            // í™”ì¥ì‹¤ ID ì•½ì‹ìœ¼ë¡œ ë³€í™˜
            let markerId = '';
    
            // ê¸‰ì‹ì‹¤ì¸µ í™”ì¥ì‹¤ íŒ¨í„´ (ì˜ˆ: "ê¸‰ì‹ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤1" -> "ê¸‰1")
            const cafeteriaMatch = toiletName.match(/ê¸‰ì‹ì‹¤ì¸µ\s*(ë‚¨ì|ì—¬ì)í™”ì¥ì‹¤(\d*)/);
            if (cafeteriaMatch) {
                const gender = cafeteriaMatch[1] === 'ë‚¨ì' ? 'ë‚¨' : 'ì—¬';
                const number = cafeteriaMatch[2] || '';
                markerId = 'ê¸‰' + number;
            } 
            // í•™ë…„ì¸µ í™”ì¥ì‹¤ íŒ¨í„´ (ì˜ˆ: "1í•™ë…„ì¸µ ë‚¨ìí™”ì¥ì‹¤" -> "1ë‚¨")
            else if (toiletName.match(/(\d+)í•™ë…„ì¸µ/)) {
                const gradeMatch = toiletName.match(/(\d+)í•™ë…„ì¸µ\s*(ë‚¨ì|ì—¬ì)/);
                if (gradeMatch) {
                    markerId = gradeMatch[1] + (gradeMatch[2] === 'ë‚¨ì' ? 'ë‚¨' : 'ì—¬');
                }
            } 
            // ë³´ê±´ì‹¤ì¸µ í™”ì¥ì‹¤ íŒ¨í„´ (ì˜ˆ: "ë³´ê±´ì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤" -> "ë³´ë‚¨")
            else if (toiletName.includes('ë³´ê±´ì‹¤ì¸µ')) {
                const genderMatch = toiletName.match(/(ë‚¨ì|ì—¬ì)/);
                if (genderMatch) {
                    markerId = 'ë³´' + (genderMatch[1] === 'ë‚¨ì' ? 'ë‚¨' : 'ì—¬');
                }
            } 
            // ììŠµì‹¤ì¸µ í™”ì¥ì‹¤ íŒ¨í„´ (ì˜ˆ: "ììŠµì‹¤ì¸µ ë‚¨ìí™”ì¥ì‹¤1" -> "ìë‚¨1")
            else if (toiletName.includes('ììŠµì‹¤ì¸µ')) {
                const studyRoomMatch = toiletName.match(/ììŠµì‹¤ì¸µ\s*(ë‚¨ì|ì—¬ì)í™”ì¥ì‹¤(\d*)/);
                if (studyRoomMatch) {
                    const gender = studyRoomMatch[1] === 'ë‚¨ì' ? 'ë‚¨' : 'ì—¬';
                    const number = studyRoomMatch[2] || '';
                    markerId = 'ì' + gender + number;
                }
            }
            // ì¼ë°˜ ì¸µ íŒ¨í„´ (ì˜ˆ: "1ì¸µ ë‚¨ìí™”ì¥ì‹¤" -> "1ë‚¨")
            else {
                const floorMatch = toiletName.match(/(\d+)ì¸µ\s*(ë‚¨ì|ì—¬ì)/);
                if (floorMatch) {
                    markerId = floorMatch[1] + (floorMatch[2] === 'ë‚¨ì' ? 'ë‚¨' : 'ì—¬');
                }
            }
    
            // ì¼ì¹˜í•˜ëŠ” ë§ˆì»¤ê°€ ì—†ìœ¼ë©´ ì¢…ë£Œ
            if (!markerId) {
                return;
            }
    
            // ëª¨ë“  í™”ì¥ì‹¤ ë§ˆì»¤ë¥¼ ì°¾ì•„ì„œ IDê°€ ì¼ì¹˜í•˜ëŠ” ê²ƒì„ ì—…ë°ì´íŠ¸
            const markers = document.querySelectorAll('.toilet-marker');
            markers.forEach(marker => {
                if (marker.textContent.trim() === markerId) {
                    marker.classList.remove('clean', 'normal', 'dirty');
        
                    // ì²­ê²° ìƒíƒœì— ë”°ë¼ í´ë˜ìŠ¤ ì¶”ê°€
                    if (cleanlinessStatus === 'clean') {
                        marker.classList.add('clean');
                    } else if (cleanlinessStatus === 'dirty') {
                        marker.classList.add('dirty');
                    } else {
                        marker.classList.add('normal');
                    }
                }
            });
        }

        // í™”ì¥ì‹¤ ìƒì„¸ UI ì—…ë°ì´íŠ¸
        function updateToiletDetailUI(data) {
            // ì²­ê²°ë„, í˜¼ì¡ë„, ë¹„í’ˆ í…ìŠ¤íŠ¸ ë³€í™˜
            const cleanlinessText = getStatusText('cleanliness', data.cleanliness);
            const crowdednessText = getStatusText('crowdedness', data.crowdedness);
            const suppliesText = getStatusText('supplies', data.supplies);
    
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('detailCleanliness').textContent = cleanlinessText;
            document.getElementById('detailCrowdedness').textContent = crowdednessText;
            document.getElementById('detailSupplies').textContent = suppliesText;
            document.getElementById('detailTimestamp').textContent = getTimeAgo(data.createdAt) + " ì—…ë°ì´íŠ¸";
    
            // ìƒíƒœ í´ë˜ìŠ¤ ì„¤ì •
            setStatusClass('detailCleanliness', cleanlinessText);
            setStatusClass('detailCrowdedness', crowdednessText);
            setStatusClass('detailSupplies', suppliesText);
        }

        // í™”ì¥ì‹¤ ì¹´ë“œ ì—…ë°ì´íŠ¸
        function updateToiletCard(toiletName, data) {
            // í•´ë‹¹ ì´ë¦„ì˜ ì¹´ë“œ ì°¾ê¸°
            const cards = document.querySelectorAll('.toilet-card');
            let targetCard = null;
    
            cards.forEach(card => {
                const cardTitle = card.querySelector('.toilet-name');
                if (cardTitle && cardTitle.textContent === toiletName) {
                    targetCard = card;
                }
            });
    
            if (!targetCard) return; // ì¹´ë“œê°€ ì—†ìœ¼ë©´ ì¢…ë£Œ
    
            // ì²­ê²°ë„, í˜¼ì¡ë„, ë¹„í’ˆ í…ìŠ¤íŠ¸ ë³€í™˜
            const cleanlinessText = getStatusText('cleanliness', data.cleanliness);
            const crowdednessText = getStatusText('crowdedness', data.crowdedness);
            const suppliesText = getStatusText('supplies', data.supplies);
    
            // ê°’ ë° í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸
            const statusValues = targetCard.querySelectorAll('.status-value');
            statusValues[0].textContent = cleanlinessText;
            statusValues[1].textContent = crowdednessText;
            statusValues[2].textContent = suppliesText;
    
            // í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸
            statusValues[0].className = 'status-value ' + getValueClass(cleanlinessText);
            statusValues[1].className = 'status-value ' + getValueClass(crowdednessText);
            statusValues[2].className = 'status-value ' + getValueClass(suppliesText);
    
            // íƒ€ì„ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸
            targetCard.querySelector('.timestamp').textContent = getTimeAgo(data.createdAt) + " ì—…ë°ì´íŠ¸";
        }

        // ì‹œê°„ í¬ë§·íŒ… (në¶„ ì „, nì‹œê°„ ì „ ë“±)
        function getTimeAgo(timestamp) {
            const now = new Date().getTime();
            const diff = now - timestamp;
    
            // 1ë¶„ ë¯¸ë§Œ
            if (diff < 60000) {
                return "ë°©ê¸ˆ ì „";
            }
            // 1ì‹œê°„ ë¯¸ë§Œ
            else if (diff < 3600000) {
                return Math.floor(diff / 60000) + "ë¶„ ì „";
            }
            // 1ì¼ ë¯¸ë§Œ
            else if (diff < 86400000) {
                return Math.floor(diff / 3600000) + "ì‹œê°„ ì „";
            }
            // ê·¸ ì´ìƒ
            else {
                const date = new Date(timestamp);
                return `${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
            }
        }

        // ì•± ì´ˆê¸°í™” í•¨ìˆ˜ (ê¸°ì¡´ ì½”ë“œ ëŒ€ì²´)
        function initApp() {
            // Firebase ì´ˆê¸°í™”
            const database = initFirebase();
    
            if (database) {
                console.log("Firebase ì—°ê²° ì„±ê³µ");
        
                // ì „ì²´ í™”ì¥ì‹¤ ë°ì´í„° ë¡œë“œ
                updateAllToilets();
        
                // ì‹¤ì‹œê°„ ë°ì´í„° ë¦¬ìŠ¤ë„ˆ ì„¤ì • (ì„ íƒì‚¬í•­)
                const latestRef = database.ref('latestStatus');
                latestRef.on('child_changed', (snapshot) => {
                    const toiletName = snapshot.key.replace(/_/g, ' ');
                    const data = snapshot.val();
            
                    // UI ì—…ë°ì´íŠ¸
                    updateToiletMarker(toiletName, data.cleanliness);
                    updateToiletCard(toiletName, data);
            
                    // í˜„ì¬ ë³´ê³  ìˆëŠ” í™”ì¥ì‹¤ì´ë©´ ìƒì„¸ ì •ë³´ë„ ì—…ë°ì´íŠ¸
                    if (selectedToilet === toiletName && document.getElementById('detailModal').style.display === 'flex') {
                        updateToiletDetailUI(data);
                        loadToiletHistory(toiletName);
                    }
                });
            } else {
                console.warn("Firebase ì—°ê²° ì‹¤íŒ¨, ë¡œì»¬ ë°ì´í„° ì‚¬ìš©");
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•± ì´ˆê¸°í™”
        window.onload = initApp;
    </script>
</body>
</html>